<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AiDoc.work - å›¾ç‰‡è‰²å·æå–</title>
    <link rel="icon" type="image/png" href="https://www.aidoc.work/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        html {
            overflow-y: scroll; /* å§‹ç»ˆæ˜¾ç¤ºå‚ç›´æ»šåŠ¨æ¡ */
            scrollbar-width: thin; /* Firefox */
        }
        
        /* é’ˆå¯¹WebKitæµè§ˆå™¨çš„æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px; /* æ»šåŠ¨æ¡å®½åº¦ */
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1; /* æ»šåŠ¨æ¡è½¨é“èƒŒæ™¯è‰² */
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; /* æ»šåŠ¨æ¡æ»‘å—é¢œè‰² */
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; /* é¼ æ ‡æ‚¬åœæ—¶æ»‘å—é¢œè‰² */
        }

        body {
            background: #f8f9fa;
            min-height: 100vh;
            color: #333;
        }

        /* å¯¼èˆªæ æ ·å¼ */
        .nav-bar {
            background: white;
            padding: 15px 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .nav-brand {
            font-size: 1.2em;
            font-weight: 600;
            color: #1a73e8;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-link {
            color: #4a5568;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            height: 36px;
        }

        .nav-link:hover {
            background: #f0f2f5;
            color: #1a73e8;
        }

        .nav-link.active {
            background: #e8f0fe;
            color: #1a73e8;
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px; /* ç§»é™¤åº•éƒ¨å†…è¾¹è· */
            text-align: center;
        }
        
        /* å†…å®¹å¸ƒå±€ */
        .content-layout {
            display: flex;
            flex-direction: row;
            gap: 2rem;
            margin-top: 2rem;
            align-items: flex-start;
        }
        
        .left-column {
            flex: 1;
            min-width: 0;
        }
        
        .right-column {
            flex: 1;
            min-width: 0;
        }

        .header {
            margin-bottom: 2rem;
        }

        .header h1 {
            color: #1a73e8;
            font-size: 2em;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #666;
            font-size: 1em;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }

        /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }

        .upload-area {
            width: 100%;
            max-width: 500px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .upload-area:hover {
            border-color: #1a73e8;
            background: #f0f7ff;
        }

        .upload-icon {
            font-size: 3rem;
            color: #1a73e8;
            margin-bottom: 1rem;
        }

        .upload-text {
            color: #4a5568;
            margin-bottom: 1rem;
        }

        .upload-btn {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-btn:hover {
            background: #1557b0;
        }

        #fileInput {
            display: none;
        }

        /* å›¾ç‰‡é¢„è§ˆåŒºåŸŸ */
        .preview-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            display: none;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .reupload-btn {
            background: #f0f2f5;
            color: #4a5568;
            border: 1px solid #d1d5db;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reupload-btn:hover {
            background: #e2e8f0;
        }

        /* é€‰é¡¹åŒºåŸŸ */
        .options-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .option-label {
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }

        .option-select {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            background: white;
            font-size: 0.9rem;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 150px;
        }

        .option-select:hover {
            border-color: #1a73e8;
        }

        .option-select:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        /* ç»“æœåŒºåŸŸ */
        .results-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem; /* å‡å°‘åº•éƒ¨è¾¹è· */
            height: auto; /* æ”¹ä¸ºè‡ªåŠ¨é«˜åº¦ */
            overflow: visible; /* å…è®¸å†…å®¹æº¢å‡º */
        }

        .results-title {
            font-size: 1.2rem;
            color: #1a73e8;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.6rem;
            padding: 0.8rem;
            width: 100%;
            box-sizing: border-box;
            max-width: 1200px;
            margin: 0 auto;
        }

        .color-block {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 0.6rem 0.5rem;
            border-radius: 7px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            min-height: 85px;
            backdrop-filter: blur(5px);
            margin: 0.1rem;
            width: 100%;
            box-sizing: border-box;
        }

        .color-block:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .color-info {
            background: rgba(0, 0, 0, 0.7);
            padding: 0.3rem 0.3rem;
            border-radius: 5px;
            text-align: center;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            margin-bottom: 0.2rem;
            width: 100%;
            box-sizing: border-box;
        }

        .color-percentage {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 0.15rem;
            background: linear-gradient(135deg, #ffffff 30%, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .color-value {
            font-size: 0.75rem;
            padding: 0.25rem 0.3rem;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.5);
            margin-top: 0.15rem;
            word-break: break-all;
        }

        .color-label {
            font-size: 0.65rem;
            font-weight: 500;
            letter-spacing: 0.5px;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.2rem 0.25rem;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.15rem;
            overflow: visible;
            white-space: normal;
            word-break: break-all;
            line-height: 1.2;
            max-width: 100%;
        }

        .color-block:hover .color-info {
            background: rgba(0, 0, 0, 0.75);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px) scale(1.005);
        }

        .color-percentage {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 0.15rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
            letter-spacing: 0.3px;
            background: linear-gradient(135deg, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .color-value {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            background: rgba(0, 0, 0, 0.45);
            padding: 0.25rem 0.3rem;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: visible;
            white-space: normal;
            word-break: break-all;
            line-height: 1.2;
            max-width: 100%;
        }

        .color-value:hover {
            background: rgba(0, 0, 0, 0.55);
            transform: translateY(-1px) scale(1.01);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .color-label {
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 1);
            background: rgba(0, 0, 0, 0.5);
            padding: 0.25rem 0.3rem;
            border-radius: 5px;
            align-self: flex-start;
            letter-spacing: 0.5px;
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 0.2rem;
            max-width: 100%;
            overflow: visible;
            white-space: normal;
            word-break: break-all;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.7);
        }

        .color-block:hover .color-label {
            opacity: 1 !important;
            transform: scale(1.01);
            background: rgba(0, 0, 0, 0.6);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .copy-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            z-index: 10;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.4);
        }

        .show-copy-message {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.05);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 992px) {
            .content-layout {
                flex-direction: column;
            }
            
            .left-column, .right-column {
                width: 100%;
            }
            
            .results-section {
                margin-top: 1rem;
            }
        }
        
        /* ç¡®ä¿åœ¨æ‰€æœ‰å±å¹•å°ºå¯¸ä¸‹éƒ½æ˜¾ç¤º3ä¸ªè‰²å—ä¸€è¡Œ */
        @media (min-width: 1px) {
            .color-grid {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
                gap: 0.4rem;
                padding: 0.4rem;
            }

            .color-block {
                padding: 0.5rem 0.4rem;
                border-radius: 6px;
                min-height: 80px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.1);
                margin: 0.05rem;
            }

            .color-info {
                padding: 0.25rem 0.25rem;
                border-radius: 4px;
                margin-bottom: 0.15rem;
            }

            .color-percentage {
                font-size: 0.85rem;
                margin-bottom: 0.1rem;
            }

            .color-value {
                font-size: 0.7rem;
                padding: 0.2rem 0.25rem;
                border-radius: 3px;
                margin-top: 0.1rem;
            }

            .color-label {
                font-size: 0.6rem;
                padding: 0.15rem 0.2rem;
                border-radius: 3px;
                margin-top: 0.1rem;
            }
        }

        /* è¶…å°å±å¹•ä¸‹è°ƒæ•´å†…è¾¹è·å’Œå­—ä½“å¤§å°ï¼Œä½†ä¿æŒ5ä¸ªè‰²å—ä¸€è¡Œ */
        @media (max-width: 480px) {
            .color-grid {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
                gap: 0.4rem;
                padding: 0.4rem;
            }
            
            .color-block {
                padding: 0.5rem 0.3rem;
                min-height: 80px;
            }
            
            .color-percentage {
                font-size: 0.8rem;
            }
            
            .color-value {
                font-size: 0.7rem;
                padding: 0.3rem 0.4rem;
                word-break: break-all;
                white-space: normal;
                line-height: 1.3;
            }
            
            .color-label {
                font-size: 0.7rem;
                padding: 0.2rem 0.3rem;
                word-break: break-all;
                white-space: normal;
            }
        }
        
        /* æ·»åŠ è¶…å°å±å¹•æ”¯æŒ */
        @media (max-width: 360px) {
            .color-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 0.3rem;
                padding: 0.3rem;
            }
            
            .color-block {
                padding: 0.4rem 0.3rem;
                border-radius: 6px;
                min-height: 70px;
            }
            
            .color-info {
                padding: 0.3rem 0.2rem;
                border-radius: 5px;
                margin-bottom: 0.1rem;
            }
            
            .color-percentage {
                font-size: 0.7rem;
                margin-bottom: 0.2rem;
            }
            
            .color-value {
                font-size: 0.65rem;
                padding: 0.15rem 0.25rem;
                border-radius: 4px;
            }
            
            .color-label {
                font-size: 0.65rem;
                padding: 0.15rem 0.3rem;
                word-break: break-all;
                white-space: normal;
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="nav-bar">
        <a href="https://www.aidoc.work" class="nav-brand">
            <span>ğŸ”§</span>
            <span>AiDoc.work</span>
        </a>
        <div class="nav-links">
            <a href="index.html" class="nav-link">ğŸ  é¦–é¡µ</a>
            <a href="æ–‡æœ¬å¤„ç†å·¥å…·.html" class="nav-link">ğŸ”§ æ–‡æœ¬å¤„ç†</a>
            <a href="æ–‡æœ¬å·®å¼‚æ¯”å¯¹.html" class="nav-link">ğŸ” å·®å¼‚æ¯”å¯¹</a>
            <a href="jsä¸²å¤„ç†å·¥å…·.html" class="nav-link">ğŸ“ JSONè§£æ</a>
            <a href="è¡¨æ ¼è½¬åˆ¶.html" class="nav-link">ğŸ“Š è¡¨æ ¼è½¬åˆ¶</a>
            <a href="å›¾ç‰‡è‰²å·æå–.html" class="nav-link active">ğŸ¨ è‰²å·æå–</a>
            <a href="æ•°æ®åŒå‘¨æŠ¥å·¥å…·.html" class="nav-link">ğŸ“ˆ æ•°æ®åŒå‘¨æŠ¥</a>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="container">
        <!-- æ ‡é¢˜å’Œæè¿° -->
        <div class="header">
            <h1>ä»å›¾ç‰‡ä¸­æå–é¢œè‰²</h1>
            <p>æŠŠä½ æœ€å–œçˆ±çš„è‰²å½©ç”¨è°ƒè‰²æ¿ä¿å­˜ä¸‹æ¥ã€‚ä½¿ç”¨åœ¨çº¿è°ƒè‰²æ¿ç”Ÿæˆå™¨ï¼Œä½ å¯ä»¥åœ¨å‡ ç§’é’Ÿå†…åˆ›å»ºåŠ¨äººçš„é…è‰²æ–¹æ¡ˆã€‚åªéœ€ä¸Šä¼ ä¸€å¼ ç…§ç‰‡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ•æ‰è¯¥ç…§ç‰‡ä¸­çš„é¢œè‰²ï¼Œå¹¶åˆ›å»ºè‡ªå®šä¹‰è°ƒè‰²æ¿ã€‚</p>
        </div>

        <!-- å†…å®¹å¸ƒå±€ -->
        <div class="content-layout">
            <!-- å·¦ä¾§åˆ—ï¼šä¸Šä¼ åŒºåŸŸ -->
            <div class="left-column">
                <!-- ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">æ‹–æ”¾å›¾ç‰‡åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                        <button class="upload-btn" id="uploadBtn">é€‰æ‹©å›¾ç‰‡</button>
                        <input type="file" id="fileInput" accept="image/*">
                    </div>

                    <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
                    <div class="preview-container" id="previewContainer">
                        <img id="previewImage" class="preview-image" src="" alt="é¢„è§ˆå›¾ç‰‡">
                        <button class="reupload-btn" id="reuploadBtn">é‡æ–°ä¸Šä¼ </button>
                    </div>
                </div>

                <!-- é€‰é¡¹åŒºåŸŸ -->
                <div class="options-section">
                    <div class="option-group">
                        <div class="option-label">é¢œè‰²æ ¼å¼</div>
                        <select class="option-select" id="colorFormat">
                            <option value="hex">HEX</option>
                            <option value="rgb">RGB</option>
                            <option value="cmyk">CMYK</option>
                            <option value="hsl">HSL</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <div class="option-label">é¢œè‰²æ•°é‡</div>
                        <select class="option-select" id="colorCount">
                            <option value="3" selected>3ä¸ªé¢œè‰²</option>
                            <option value="6">6ä¸ªé¢œè‰²</option>
                            <option value="9">9ä¸ªé¢œè‰²</option>
                            <option value="12">12ä¸ªé¢œè‰²</option>
                            <option value="15">15ä¸ªé¢œè‰²</option>
                            <option value="20">20ä¸ªé¢œè‰²</option>
                            <option value="25">25ä¸ªé¢œè‰²</option>
                            <option value="30">30ä¸ªé¢œè‰²</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§åˆ—ï¼šç»“æœåŒºåŸŸ -->
            <div class="right-column">
                <!-- ç»“æœåŒºåŸŸ -->
                <div class="results-section" id="resultsSection" style="display: none;">
                    <div class="results-title">æå–çš„é¢œè‰²</div>
                    <div class="color-grid" id="colorGrid">
                        <!-- é¢œè‰²å—å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadArea = document.getElementById('uploadArea');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const reuploadBtn = document.getElementById('reuploadBtn');
        const resultsSection = document.getElementById('resultsSection');
        const colorGrid = document.getElementById('colorGrid');
        const colorFormat = document.getElementById('colorFormat');
        const colorCount = document.getElementById('colorCount');

        // ä¸Šä¼ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // æ‹–æ”¾åŠŸèƒ½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#1a73e8';
            uploadArea.style.background = '#f0f7ff';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#d1d5db';
            uploadArea.style.background = 'white';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#d1d5db';
            uploadArea.style.background = 'white';
            
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFile(e.target.files[0]);
            }
        });

        // é‡æ–°ä¸Šä¼ æŒ‰é’®
        reuploadBtn.addEventListener('click', () => {
            previewContainer.style.display = 'none';
            uploadArea.style.display = 'block';
            resultsSection.style.display = 'none';
        });
        
        // è®¾ç½®é»˜è®¤é¢œè‰²æ ¼å¼ä¸ºHEXå’Œé»˜è®¤é¢œè‰²æ•°é‡ä¸º3
        colorFormat.value = 'hex';
        colorCount.value = '3';

        // é¢œè‰²æ ¼å¼å’Œæ•°é‡å˜åŒ–äº‹ä»¶
        colorFormat.addEventListener('change', updateColorDisplay);
        colorCount.addEventListener('change', () => {
            if (previewImage.src) {
                analyzeImage();
            }
        });

        // å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
        function handleFile(file) {
            if (!file.type.match('image.*')) {
                alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                uploadArea.style.display = 'none';
                previewContainer.style.display = 'block';
                analyzeImage();
            };
            reader.readAsDataURL(file);
        }

        // åˆ†æå›¾ç‰‡é¢œè‰²
        function analyzeImage() {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0, img.width, img.height);

                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const colors = extractColors(imageData, parseInt(colorCount.value));
                displayColors(colors);
                resultsSection.style.display = 'block';
            };
            img.src = previewImage.src;
        }

        // æå–é¢œè‰²
        function extractColors(imageData, colorNum) {
            const pixelCount = imageData.width * imageData.height;
            const pixelArray = imageData.data;
            const colorMap = {};

            // é‡‡æ ·ç‡ï¼Œå‡å°‘è®¡ç®—é‡
            const sampleRate = Math.max(1, Math.floor(pixelCount / 10000));

            for (let i = 0; i < pixelArray.length; i += 4 * sampleRate) {
                const r = pixelArray[i];
                const g = pixelArray[i + 1];
                const b = pixelArray[i + 2];
                const a = pixelArray[i + 3];

                // å¿½ç•¥é€æ˜åƒç´ 
                if (a < 128) continue;

                // é‡åŒ–é¢œè‰²ï¼Œå‡å°‘é¢œè‰²æ•°é‡
                const quantizedR = Math.round(r / 8) * 8;
                const quantizedG = Math.round(g / 8) * 8;
                const quantizedB = Math.round(b / 8) * 8;

                const colorKey = `${quantizedR},${quantizedG},${quantizedB}`;

                if (colorMap[colorKey]) {
                    colorMap[colorKey].count++;
                } else {
                    colorMap[colorKey] = {
                        r: quantizedR,
                        g: quantizedG,
                        b: quantizedB,
                        count: 1
                    };
                }
            }

            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            let colorArray = Object.values(colorMap);
            colorArray.sort((a, b) => b.count - a.count);

            // è®¡ç®—ç™¾åˆ†æ¯”
            const totalSamples = colorArray.reduce((sum, color) => sum + color.count, 0);
            colorArray = colorArray.map(color => {
                return {
                    ...color,
                    percentage: Math.round((color.count / totalSamples) * 100)
                };
            });
            
            // è®¡ç®—é¢œè‰²ç›¸ä¼¼åº¦å¹¶è¿‡æ»¤ç›¸ä¼¼é¢œè‰²
            const filteredColors = [];
            const similarityThreshold = 0.88; // 95%ç›¸ä¼¼åº¦é˜ˆå€¼
            
            // è®¡ç®—ä¸¤ä¸ªé¢œè‰²çš„ç›¸ä¼¼åº¦
            function calculateColorSimilarity(color1, color2) {
                // ä½¿ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»è®¡ç®—RGBç©ºé—´ä¸­çš„é¢œè‰²ç›¸ä¼¼åº¦
                const rDiff = color1.r - color2.r;
                const gDiff = color1.g - color2.g;
                const bDiff = color1.b - color2.b;
                
                // è®¡ç®—å½’ä¸€åŒ–çš„è·ç¦» (0-1èŒƒå›´)
                const distance = Math.sqrt(rDiff*rDiff + gDiff*gDiff + bDiff*bDiff) / Math.sqrt(3 * 255 * 255);
                
                // è¿”å›ç›¸ä¼¼åº¦ (1 = å®Œå…¨ç›¸åŒ, 0 = å®Œå…¨ä¸åŒ)
                return 1 - distance;
            }
            
            // è¿‡æ»¤ç›¸ä¼¼é¢œè‰²
            for (const color of colorArray) {
                // æ£€æŸ¥è¿™ä¸ªé¢œè‰²æ˜¯å¦ä¸å·²è¿‡æ»¤çš„é¢œè‰²ç›¸ä¼¼
                let isSimilar = false;
                
                for (const filteredColor of filteredColors) {
                    const similarity = calculateColorSimilarity(color, filteredColor);
                    
                    if (similarity >= similarityThreshold) {
                        // å¦‚æœç›¸ä¼¼ï¼Œå°†å½“å‰é¢œè‰²çš„è®¡æ•°æ·»åŠ åˆ°å·²è¿‡æ»¤é¢œè‰²çš„è®¡æ•°ä¸­
                        filteredColor.count += color.count;
                        isSimilar = true;
                        break;
                    }
                }
                
                // å¦‚æœä¸ç›¸ä¼¼ï¼Œæ·»åŠ åˆ°è¿‡æ»¤åçš„é¢œè‰²åˆ—è¡¨
                if (!isSimilar) {
                    filteredColors.push(color);
                }
            }
            
            // é‡æ–°è®¡ç®—è¿‡æ»¤åé¢œè‰²çš„ç™¾åˆ†æ¯”
            const filteredTotalSamples = filteredColors.reduce((sum, color) => sum + color.count, 0);
            filteredColors.forEach(color => {
                color.percentage = Math.round((color.count / filteredTotalSamples) * 100);
            });
            
            // é‡æ–°æ’åºå¹¶å–å‰Nä¸ªé¢œè‰²
            filteredColors.sort((a, b) => b.count - a.count);
            let finalColors = filteredColors.slice(0, colorNum);

            // é‡æ–°è®¡ç®—ç™¾åˆ†æ¯”ï¼Œç¡®ä¿æ€»å’Œä¸º100%
            const totalPercentage = finalColors.reduce((sum, color) => sum + color.percentage, 0);
            if (totalPercentage !== 100) {
                const factor = 100 / totalPercentage;
                let sumPercentage = 0;
                
                // è°ƒæ•´å‰N-1ä¸ªé¢œè‰²çš„ç™¾åˆ†æ¯”
                for (let i = 0; i < finalColors.length - 1; i++) {
                    finalColors[i].percentage = Math.round(finalColors[i].percentage * factor);
                    sumPercentage += finalColors[i].percentage;
                }
                
                // æœ€åä¸€ä¸ªé¢œè‰²çš„ç™¾åˆ†æ¯”ä¸ºå‰©ä½™éƒ¨åˆ†
                if (finalColors.length > 0) {
                    finalColors[finalColors.length - 1].percentage = 100 - sumPercentage;
                }
            }

            return finalColors;
        }

        // æ˜¾ç¤ºé¢œè‰²
        function displayColors(colors) {
            colorGrid.innerHTML = '';
            
            colors.forEach(color => {
                const colorBlock = document.createElement('div');
                colorBlock.className = 'color-block';
                colorBlock.style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
                
                // åˆ›å»ºé¢œè‰²æ ‡ç­¾å…ƒç´  - æ˜¾ç¤ºåœ¨é¡¶éƒ¨
                const colorLabel = document.createElement('div');
                colorLabel.className = 'color-label';
                colorLabel.textContent = `#${((1 << 24) + (color.r << 16) + (color.g << 8) + color.b).toString(16).slice(1).toUpperCase()}`;
                colorLabel.style.opacity = '0.7';
                
                // åˆ›å»ºé¢œè‰²ä¿¡æ¯å…ƒç´  - æ˜¾ç¤ºåœ¨åº•éƒ¨
                const colorInfo = document.createElement('div');
                colorInfo.className = 'color-info';
                
                // æˆ‘ä»¬ç°åœ¨ä½¿ç”¨å›ºå®šçš„ç™½è‰²æ–‡å­—ï¼Œå› ä¸ºèƒŒæ™¯æ˜¯åŠé€æ˜é»‘è‰²
                // ä½†ä»ç„¶ä¿ç•™äº®åº¦è®¡ç®—ï¼Œä»¥ä¾¿å°†æ¥å¯èƒ½çš„æ ·å¼è°ƒæ•´
                const brightness = (color.r * 299 + color.g * 587 + color.b * 114) / 1000;
                
                const percentage = document.createElement('div');
                percentage.className = 'color-percentage';
                percentage.textContent = `${color.percentage}%`;
                
                const colorValue = document.createElement('div');
                colorValue.className = 'color-value';
                colorValue.textContent = formatColorValue(color);
                
                const copyMessage = document.createElement('div');
                copyMessage.className = 'copy-message';
                copyMessage.textContent = 'å·²å¤åˆ¶';
                
                colorInfo.appendChild(percentage);
                colorInfo.appendChild(colorValue);
                colorBlock.appendChild(colorLabel);
                colorBlock.appendChild(colorInfo);
                colorBlock.appendChild(copyMessage);
                
                // ç‚¹å‡»å¤åˆ¶é¢œè‰²å€¼
                colorBlock.addEventListener('click', () => {
                    const colorText = formatColorValue(color);
                    navigator.clipboard.writeText(colorText).then(() => {
                        copyMessage.classList.add('show-copy-message');
                        setTimeout(() => {
                            copyMessage.classList.remove('show-copy-message');
                        }, 1500);
                    });
                });
                
                colorGrid.appendChild(colorBlock);
            });
        }

        // æ ¼å¼åŒ–é¢œè‰²å€¼
        function formatColorValue(color) {
            const { r, g, b } = color;
            
            switch (colorFormat.value) {
                case 'rgb':
                    return `RGB(${r}, ${g}, ${b})`;
                case 'hex':
                    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`.toUpperCase();
                case 'cmyk':
                    const k = 1 - Math.max(r / 255, g / 255, b / 255);
                    const c = k === 1 ? 0 : Math.round(((1 - r / 255 - k) / (1 - k)) * 100);
                    const m = k === 1 ? 0 : Math.round(((1 - g / 255 - k) / (1 - k)) * 100);
                    const y = k === 1 ? 0 : Math.round(((1 - b / 255 - k) / (1 - k)) * 100);
                    const kPercent = Math.round(k * 100);
                    return `CMYK(${c}%, ${m}%, ${y}%, ${kPercent}%)`;
                case 'hsl':
                    const rNorm = r / 255;
                    const gNorm = g / 255;
                    const bNorm = b / 255;
                    const max = Math.max(rNorm, gNorm, bNorm);
                    const min = Math.min(rNorm, gNorm, bNorm);
                    let h, s, l = (max + min) / 2;
                    
                    if (max === min) {
                        h = s = 0; // ç°è‰²
                    } else {
                        const d = max - min;
                        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                        
                        switch (max) {
                            case rNorm:
                                h = (gNorm - bNorm) / d + (gNorm < bNorm ? 6 : 0);
                                break;
                            case gNorm:
                                h = (bNorm - rNorm) / d + 2;
                                break;
                            case bNorm:
                                h = (rNorm - gNorm) / d + 4;
                                break;
                        }
                        h /= 6;
                    }
                    
                    return `HSL(${Math.round(h * 360)}Â°, ${Math.round(s * 100)}%, ${Math.round(l * 100)}%)`;
                default:
                    return `RGB(${r}, ${g}, ${b})`;
            }
        }

        // æ›´æ–°é¢œè‰²æ˜¾ç¤º
        function updateColorDisplay() {
            const colorBlocks = document.querySelectorAll('.color-block');
            if (colorBlocks.length === 0) return;
            
            // è·å–å½“å‰æ˜¾ç¤ºçš„é¢œè‰²
            const colors = [];
            colorBlocks.forEach(block => {
                const style = window.getComputedStyle(block);
                const bgColor = style.backgroundColor;
                const rgb = bgColor.match(/\d+/g).map(Number);
                const percentage = block.querySelector('.color-percentage').textContent.replace('%', '');
                
                colors.push({
                    r: rgb[0],
                    g: rgb[1],
                    b: rgb[2],
                    percentage: parseInt(percentage)
                });
            });
            
            // é‡æ–°æ˜¾ç¤ºé¢œè‰²
            displayColors(colors);
        }
    </script>
</body>
</html>